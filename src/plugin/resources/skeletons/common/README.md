# [-info-long_name-]

This Rack Extension was generated by pongasoft [re-quickstart](https://pongasoft.com/re-quickstart/index.html) tool (v[-re-quickstart-version-]).

Please follow the instructions below on how to build and deploy it: the "Ultra Quick Starting Guide" is the fastest and more condensed way to have the plugin up and running. Follow the "Starting Guide" instructions for more options. 

Requirements
------------

* This project requires CMake (minimum version 3.13) to be properly installed (`cmake` executable must be in your `PATH`)
* This project currently expects RE SDK 4.3.0+ to be installed on the machine (it will not download it for you)
* Due to the RE SDK requirements, this project also requires python 3 to be installed
* It has been tested on macOS 10.14.6 with Xcode 9 installed
* It has been tested on macOS 11.1 with Xcode 12.3 installed and Apple Silicon (forces `x86_64` build to compile and run)
* It has been tested on Windows 10 with Visual Studio 16 2019 build tools

Ultra Quick Starting Guide
--------------------------

* Download the [RE SDK 4.3.0](https://developer.reasonstudios.com/downloads/rack-extension-sdk)
* Unpack/Unzip the SDK in a location of your choice (`<path to location of your choice>`) and make sure `RE2DRender` is unzipped as well and is a sibling of `SDK`
* Now run `./configure.py -p <path to location of your choice>/SDK` (resp. `python ./configure.py -p <path to location of your choice>SDK` for Win10)
* Now go into the `build` folder created by the `configure` script and run `./re.sh install` (resp. `./re.bat install` for Win10)
* Open Recon and you can now load the `[-info-long_name-]` rack extension from the `[-reason-browser-section-]` section under the `[-info-manufacturer-]` vendor.

Starting Guide
--------------

### Note about the RE SDK location

You can install the SDK wherever you want on your system and provide it as an argument to the `configure.py` script. Or you can install (or create a link) in a default location:

* `/Users/Shared/ReasonStudios/JukeboxSDK_<RE_SDK_VERSION>/SDK` for macOS
* `C:/Users/Public/Documents/ReasonStudios/JukeboxSDK_<RE_SDK_VERSION>/SDK` for Windows

Also, note that the `RE2DRender` program needs to be unzipped and is expected to be a sibling of `SDK` (can be changed as well).

> #### Note
> If you use CLion or other IDE handling CMake natively (and thus do not use the script), if you want to provide your own paths, you need to use the Settings/Preferences of the project to provide the right location to the `cmake` command line. If you are unsure about the syntax, you can always run the `configure.py` script in dry-run mode to see it:
> 
> ```
> python3 configure.py -n -p /my_path/to/sdk
> cmake "-B" "build" "-DRE_SDK_ROOT:PATH=/my_path/to/sdk" "-DCMAKE_BUILD_TYPE=Debug" "-G" "Unix Makefiles" "/.../[-info-product_id-]-plugin"
> ```
>
> Another alternative is to simply modify the location directly in `CMakeLists.txt`


### Step 1 - Configure the build

Below, you will find several ways to configure the build. You can pick whichever you prefer:

- from the command line (using `configure.py`)
- using a GUI interface (`cmake-gui`)
- loading it directly in an IDE working natively with CMake (like CLion or Visual Studio Code)
- generating a project for Xcode or Visual Studio

#### Command line (`configure.py`)

Invoking the `configure.py` **creates** a `build` directory in the directory where the command is run. Although it is strongly recommended running this command outside the source tree, the `build` directory is excluded in `.gitignore` and since everything is contained within the `build` folder it is easy to clean after the fact.

Running the `python3 configure.py -h` command will print the usage.

Note that depending on how `python` is installed on your system you may have to invoke it differently.

Note that this script is expecting the `cmake` command line tool to be in the `PATH` (use `cmake -version` to confirm it is properly installed).

```
# python3 ./configure.py -h
usage: configure.py [-h] [-n] [-f] [-R] [-p RE_SDK_ROOT] [-r RE_2D_RENDER_ROOT] [-G GENERATOR] [-- <cmake_options>]
...
```
> #### Note
> The default generator for macOS is "Unix Makefiles" (not Xcode) because it works really well and creates very fast builds.

#### `cmake-gui`

If you are more comfortable with a GUI rather than a command line interface (like `configure.py`) you can simply use `cmake-gui`. After setting the generator, select `Grouped` and look for the properties in the `RE` group. The most important ones are

```
RE_SDK_ROOT
RE_2D_RENDER_ROOT
RE_2D_RENDER_EXECUTABLE
RE_RECON_EXECUTABLE
```

#### CLion (by Jetbrains)

CLion understand CMake natively. So simply open the project in CLion. Note that CLion creates a `cmake-build-debug` folder in the source tree (also excluded in `.gitignore`) which can be changed under `Preferences / Build, Execution, Deployment / CMake / Generation Path`. Check the [notes](#note-about-the-re-sdk-location) section for how to change the paths if you don't install the SDK in its default location.  

> #### Note
> On Windows, make sure that in the `Settings / Build, Execution, Deployment / Toolchains` you have `Visual Studio` selected with an architecture `amd64`!

#### Xcode (macOS)

To create an Xcode project simply use the  `python3 configure.py -G Xcode` flavor. This will generate a `build/[-cmake_project_name-].xcodeproj` project that you can open directly in Xcode.

#### Visual Studio Code (Windows)

This section assumes that you have CMake Tools extension installed (a Microsoft extension)

1. Open Folder

   Open the project by opening the folder containing the plugin

2. Configure CMake

   Click on the CMake Icon in the toolbar then click on ‘Configure’ icon at which point you will be prompted for a Kit. You should select “Visual Studio Build Tools 2019 - amd64”. This will configure CMake.

> #### Tip
> Visual Studio Code should show a notification that states: _"CMake Tools would like to configure IntelliSense for this folder"_. It is strongly recommended allowing the action to proceed as the various includes (like the ones related to the RE SDK) will automatically be properly resolved.

#### Visual Studio (Windows)

To create a Visual Studio project simply use the command line first and invoke `python3 configure.py` (on Windows the default generator is Visual Studio). This will generate a `build/[-cmake_project_name-].sln` solution that you can open directly in Visual Studio.

### Step 2 - Install the plugin

#### Command line - `re.sh install`

After running the `configure` script, simply go into the newly generated `build` folder and run `re.sh` (resp. `re.bat`)

Note that this script is expecting the `cmake` command line tool to be in the `PATH` (use `cmake -version` to confirm it is properly installed).

```
# cd build
# ./re.sh -h
usage: re.sh [-hnvlbdtRZ] <command> [<command> ...] [-- [native-options]]
...
```

You should be able to simply run `re.sh install` (resp. `re.bat`) to have the plugin fully built and installed in its default location. 

#### IDEs - select a target and build

Select the `native-install` target/configuration and build it (Ctrl-F9 with CLion).

> #### Tip
> After the `configure` phase, the `re.sh` (resp. `re.bat`) script will be available in the build folder, so you can also run any CLI command if you want even if you set up the project in the IDE.

### Step 3 - Try the plugin

You can then open Recon and load the `[-info-long_name-]` rack extension. You will find the plugin in the `[-reason-browser-section-]` section under the `[-info-manufacturer-]` vendor.

> #### Note
> The plugin will **not** be accessible from Reason. You must use Recon. 

### Step 4 - Run the unit tests

#### Command line - `re.sh test`

Issuing this command will compile and run the unit tests (uses `re-mock`). This project provides a single basic test to demonstrate how to add new ones. Although the test provided is short, it actually does quite a lot of things: load and parse `info.lua`, `motherboard_def.lua` and `realtime_controller.lua` then instantiate the main instance class and run through one batch.

#### IDEs

Some IDEs (like CLion) are aware of unit testing natively (with Google Test) and offer the ability to run a specific test directly within the IDE. Otherwise, the target `native-run-test` will execute all of them.

### Next Steps

- Check the [SDK documentation](https://developer.reasonstudios.com/documentation/rack-extension-sdk/4.3.0/jukebox-readme) for information on how to build a Rack Extension.
- Check the [re-cmake](https://github.com/pongasoft/re-cmake) project for information about the build framework itself

### A note about debug logging

This example project uses `loguru` for debug logging, to demonstrate that it is possible to use a library that does not compile when doing _jbox_ builds but compiles when doing _native_ builds. In addition, `loguru` has a lot of features, like `DCHECK_F` to do sanity checks, various levels of logging, etc...

You do not have to use it in your own project and can use `JBOX_TRACE` and other flavors provided by the SDK but note the following:

- if you do a native build, `JBOX_TRACE` (and `loguru`) will be enabled only if the option `ENABLE_DEBUG_LOGGING` is provided to `add_re_plugin` as is the case in this example, so it is easy to turn off debug logging if you desire
- `loguru` is always disabled for jbox builds (because it cannot compile with jbox builds)
- `JBOX_TRACE` is enabled or disabled in jbox builds following the rules implemented in the SDK. The rules are:
  - for 'local45 Debugging' (`./re.sh -d local45`) `JBOX_TRACE` is enabled
  - for 'local45 Testing' (`./re.sh -t local45`) `JBOX_TRACE` is enabled
  - for 'local45 Deployment' (`./re.sh local45`) `JBOX_TRACE` is disabled
  - for 'universal45' (`./re.sh universal45`), it produces a zip file containing 2 builds, a `Testing` build for which `JBOX_TRACE` is enabled and a `Deployment` build for with `JBOX_TRACE` is disabled

Licensing
---------

- This project uses the Rack extension SDK released under the [Rack Extension License agreement](RE_License.txt)
